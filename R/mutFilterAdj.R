#' mutFilterAdj
#' @description Filter alleles based on adjacent indels/tags
#'
#' @param maf An MAF data frame, generated by \code{\link{vcfToMAF}} function.
#' @return An MAF data frame after filtering for adjacent alleles.
#' 
#' @import dplyr

mutFilterAdj <- function(maf){
  
  # sort and order variants in maf file
  mafFile <- arrange(maf, Chromosome, Start_Position)
  mafFile$Start_Position <- as.numeric(mafFile$Start_Position)
  mafFile$End_Position <- as.numeric(mafFile$End_Position)
  
  # calculate the distance between variants
  mafFile <- mafFile %>% group_by(Chromosome) %>% 
    mutate(pre_diff = Start_Position - lag(Start_Position, 
                                           default = first(Start_Position)), 
           next_diff = End_Position - lag(End_Position, 
                                          default = first(End_Position)))
  
  # filter variants
  maf_filtered <- filter(mafFile, nchar(Reference_Allele) < 50 & 
                        (pre_diff == 0 & next_diff >10) | 
                        (pre_diff == 0 & next_diff == 0) |
                        (pre_diff > 10 & next_diff > 10) | 
                        (pre_diff > 10 & next_diff < 10))
  
  # return results
  if (nrow(maf_filtered) == 0){
    message('No mutation left after adjacent tag filtering.')
  }else{
    maf_filtered <- as.data.frame(maf_filtered)
    rownames(maf_filtered) <- 1:nrow(maf_filtered)
  }
  return(maf_filtered)
}




