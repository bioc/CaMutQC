#' mutFilterNormalDP
#' @description Filter dbsnp/non-dbsnp variants based on their normal depth
#'
#' @param maf An MAF data frame, generated by \code{\link{vcfToMAF}} function.
#' 
#' @return An MAF data frame after filtration for Normal depth.
#' 
#' @export mutFilterNormalDP

mutFilterNormalDP <- function(maf) {
  if (!('Existing_variation' %in% colnames(maf))) {
    stop('No annotation from existing database detected.')
  }
  
  # build a vector to store discarded variants
  discard <- c()
  
  for (i in seq_len(nrow(maf))) {
    # variants in dbsnp
    if(length(grep('rs', maf[, 'Existing_variation']))) {
      if(maf$n_depth[i] < 19) {
        discard <- c(discard, i)
      }
      
    # variants not in dbsnp
    }else if (maf$n_depth[i] < 8) {
      discard <- c(discard, i)
    } 
 }
  
  if (is.null(discard)){
    return(maf)
  }else {
    maf_filtered <- as.data.frame(maf[-discard, ])
    if (nrow(maf_filtered) == 0){
      message('No mutation left after Normal DP filtration.')
    }else{
      rownames(maf_filtered) <- seq_len(nrow(maf_filtered))
    }
    return(maf_filtered)
  }
  
}

