#' mutFilterNormalDP
#' @description Filter dbsnp/non-dbsnp variants based on their normal depth.
#' Variants in dbSNP database should have normal depth >= 19, while non-dbSNP
#' variants should have normal depth >= 8 to avoid being filtered.
#' @param maf An MAF data frame, generated by \code{\link{vcfToMAF}} function.
#' @return An MAF data frame where some variants
#' has N tag in CaTag column for Normal depth filtration.
#' @export mutFilterNormalDP
#' @examples
#' maf <- vcfToMAF(system.file("extdata",
#' "WES_EA_T_1_mutect2.vep.vcf",package = "CaMutQC"))
#' mafF <- mutFilterNormalDP(maf)


mutFilterNormalDP <- function(maf) {
    if (!('Existing_variation' %in% colnames(maf))) {
      discard <- c()
      mes <- paste0('No annotation from existing database detected, ', 
                    "mutFilterNormalDP function will not run.")
      message(mes)
    }
    # build a vector to store discarded variants
    discard <- rep(NA, length(maf))
    for (i in seq_len(nrow(maf))) {
      # variants in dbsnp
      if(length(grep('rs', maf[i, 'Existing_variation']))) {
        if(maf$n_depth[i] < 19) {
          discard[i] <- i
        }
      # variants not in dbsnp
      }else if (maf$n_depth[i] < 8) {
        discard[i] <- i
      }
    }
    # add tag
    discard <- as.vector(na.omit(discard))
    maf[discard, 'CaTag'] <- paste0(maf[discard, 'CaTag'], 'N')
    return(maf)
}

